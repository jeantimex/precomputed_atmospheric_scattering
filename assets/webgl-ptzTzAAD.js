import"./modulepreload-polyfill-B5Qt9EMX.js";const T="data:text/plain;base64,I3ZlcnNpb24gMzAwIGVzCnByZWNpc2lvbiBoaWdocCBmbG9hdDsKCnVuaWZvcm0gbWF0NCBtb2RlbF9mcm9tX3ZpZXc7CnVuaWZvcm0gbWF0NCB2aWV3X2Zyb21fY2xpcDsKCmxheW91dChsb2NhdGlvbiA9IDApIGluIHZlYzQgdmVydGV4OwpvdXQgdmVjMyB2aWV3X3JheTsKCnZvaWQgbWFpbigpIHsKICB2aWV3X3JheSA9IChtb2RlbF9mcm9tX3ZpZXcgKiB2ZWM0KCh2aWV3X2Zyb21fY2xpcCAqIHZlcnRleCkueHl6LCAwLjApKS54eXo7CiAgZ2xfUG9zaXRpb24gPSB2ZXJ0ZXg7Cn0K",A="/precomputed_atmospheric_scattering/assets/fragment_shader-DovAqpAK.txt",R="/precomputed_atmospheric_scattering/assets/atmosphere_shader-CN--XQjv.txt",f=256,g=64,E=256,p=128,v=32,_=64,x=16,d=.00935/2,l=1e3;class S{constructor(e){this.canvas=e.querySelector("#glcanvas"),this.canvas.style.width=`${e.clientWidth}px`,this.canvas.style.height=`${e.clientHeight}px`,this.canvas.width=e.clientWidth*window.devicePixelRatio,this.canvas.height=e.clientHeight*window.devicePixelRatio,this.help=e.querySelector("#help"),this.gl=this.canvas.getContext("webgl2"),this.vertexBuffer=null,this.transmittanceTexture=null,this.scatteringTexture=null,this.irradianceTexture=null,this.vertexShaderSource=null,this.fragmentShaderSource=null,this.atmosphereShaderSource=null,this.program=null,this.viewFromClip=new Float32Array(16),this.modelFromView=new Float32Array(16),this.viewDistanceMeters=9e3,this.viewZenithAngleRadians=1.47,this.viewAzimuthAngleRadians=-.1,this.sunZenithAngleRadians=1.3,this.sunAzimuthAngleRadians=2.9,this.exposure=10,this.drag=void 0,this.previousMouseX=void 0,this.previousMouseY=void 0,e.addEventListener("keypress",i=>this.onKeyPress(i)),e.addEventListener("mousedown",i=>this.onMouseDown(i)),e.addEventListener("mousemove",i=>this.onMouseMove(i)),e.addEventListener("mouseup",i=>this.onMouseUp(i)),e.addEventListener("wheel",i=>this.onMouseWheel(i)),this.init(),requestAnimationFrame(()=>this.onRender())}init(){const e=this.gl,i=t=>new URL(t,import.meta.url).href;this.vertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,1]),e.STATIC_DRAW),r.loadTextureData(i("transmittance.dat"),t=>{this.transmittanceTexture=r.createTexture(e,e.TEXTURE0,e.TEXTURE_2D),e.texImage2D(e.TEXTURE_2D,0,e.getExtension("OES_texture_float_linear")?e.RGBA32F:e.RGBA16F,f,g,0,e.RGBA,e.FLOAT,t)}),r.loadTextureData(i("scattering.dat"),t=>{this.scatteringTexture=r.createTexture(e,e.TEXTURE1,e.TEXTURE_3D),e.texParameteri(e.TEXTURE_3D,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),e.texImage3D(e.TEXTURE_3D,0,e.RGBA16F,E,p,v,0,e.RGBA,e.FLOAT,t)}),r.loadTextureData(i("irradiance.dat"),t=>{this.irradianceTexture=r.createTexture(e,e.TEXTURE2,e.TEXTURE_2D),e.texImage2D(e.TEXTURE_2D,0,e.RGBA16F,_,x,0,e.RGBA,e.FLOAT,t)}),r.loadShaderSource(T,t=>{this.vertexShaderSource=t}),r.loadShaderSource(A,t=>{this.fragmentShaderSource=t}),r.loadShaderSource(R,t=>{this.atmosphereShaderSource=t})}maybeInitProgram(){if(this.program||!this.vertexShaderSource||!this.fragmentShaderSource||!this.atmosphereShaderSource)return;const e=this.gl,i=r.createShader(e,e.VERTEX_SHADER,this.vertexShaderSource),t=r.createShader(e,e.FRAGMENT_SHADER,`${this.atmosphereShaderSource}
${this.fragmentShaderSource}`);this.program=e.createProgram(),e.attachShader(this.program,i),e.attachShader(this.program,t),e.linkProgram(this.program)}onRender(){const e=this.gl;if(e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT),this.maybeInitProgram(),!this.program){requestAnimationFrame(()=>this.onRender());return}const i=50/180*Math.PI,t=Math.tan(i/2),s=this.canvas.width/this.canvas.height;this.viewFromClip.set([t*s,0,0,0,0,t,0,0,0,0,0,-1,0,0,1,1]);const o=Math.cos(this.viewZenithAngleRadians),n=Math.sin(this.viewZenithAngleRadians),h=Math.cos(this.viewAzimuthAngleRadians),c=Math.sin(this.viewAzimuthAngleRadians),u=this.viewDistanceMeters/l;this.modelFromView.set([-c,-o*h,n*h,n*h*u,h,-o*c,n*c,n*c*u,0,n,o,o*u,0,0,0,1]);const a=this.program;e.useProgram(a),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.vertexAttribPointer(e.getAttribLocation(a,"vertex"),2,this.gl.FLOAT,!1,0,0),e.enableVertexAttribArray(e.getAttribLocation(a,"vertex")),e.uniformMatrix4fv(e.getUniformLocation(a,"view_from_clip"),!0,this.viewFromClip),e.uniformMatrix4fv(e.getUniformLocation(a,"model_from_view"),!0,this.modelFromView),e.uniform1i(e.getUniformLocation(a,"transmittance_texture"),0),e.uniform1i(e.getUniformLocation(a,"scattering_texture"),1),e.uniform1i(e.getUniformLocation(a,"single_mie_scattering_texture"),1),e.uniform1i(e.getUniformLocation(a,"irradiance_texture"),2),e.uniform3f(e.getUniformLocation(a,"camera"),this.modelFromView[3],this.modelFromView[7],this.modelFromView[11]),e.uniform3f(e.getUniformLocation(a,"white_point"),1,1,1),e.uniform1f(e.getUniformLocation(a,"exposure"),this.exposure),e.uniform3f(e.getUniformLocation(a,"earth_center"),0,0,-636e4/l),e.uniform3f(e.getUniformLocation(a,"sun_direction"),Math.cos(this.sunAzimuthAngleRadians)*Math.sin(this.sunZenithAngleRadians),Math.sin(this.sunAzimuthAngleRadians)*Math.sin(this.sunZenithAngleRadians),Math.cos(this.sunZenithAngleRadians)),e.uniform2f(e.getUniformLocation(a,"sun_size"),Math.tan(d),Math.cos(d)),e.drawArrays(e.TRIANGLE_STRIP,0,4),requestAnimationFrame(()=>this.onRender())}onKeyPress(e){const i=e.key;if(i=="h"){const t=this.help.style.display=="none";this.help.style.display=t?"block":"none"}else i=="+"?this.exposure*=1.1:i=="-"?this.exposure/=1.1:i=="1"?this.setView(9e3,1.47,0,1.3,3,10):i=="2"?this.setView(9e3,1.47,0,1.564,-3,10):i=="3"?this.setView(7e3,1.57,0,1.54,-2.96,10):i=="4"?this.setView(7e3,1.57,0,1.328,-3.044,10):i=="5"?this.setView(9e3,1.39,0,1.2,.7,10):i=="6"?this.setView(9e3,1.5,0,1.628,1.05,200):i=="7"?this.setView(7e3,1.43,0,1.57,1.34,40):i=="8"?this.setView(27e5,.81,0,1.57,2,10):i=="9"&&this.setView(12e6,0,0,.93,-2,10)}setView(e,i,t,s,o,n){this.viewDistanceMeters=e,this.viewZenithAngleRadians=i,this.viewAzimuthAngleRadians=t,this.sunZenithAngleRadians=s,this.sunAzimuthAngleRadians=o,this.exposure=n}onMouseDown(e){this.previousMouseX=e.offsetX,this.previousMouseY=e.offsetY,this.drag=e.ctrlKey?"sun":"camera"}onMouseMove(e){const t=e.offsetX,s=e.offsetY;this.drag=="sun"?(this.sunZenithAngleRadians-=(this.previousMouseY-s)/500,this.sunZenithAngleRadians=Math.max(0,Math.min(Math.PI,this.sunZenithAngleRadians)),this.sunAzimuthAngleRadians+=(this.previousMouseX-t)/500):this.drag=="camera"&&(this.viewZenithAngleRadians+=(this.previousMouseY-s)/500,this.viewZenithAngleRadians=Math.max(0,Math.min(Math.PI/2,this.viewZenithAngleRadians)),this.viewAzimuthAngleRadians+=(this.previousMouseX-t)/500),this.previousMouseX=t,this.previousMouseY=s}onMouseUp(e){this.drag=void 0}onMouseWheel(e){this.viewDistanceMeters*=e.deltaY>0?1.05:1/1.05}}class r{static loadShaderSource(e,i){const t=new XMLHttpRequest;t.open("GET",e),t.responseType="text",t.onload=s=>i(t.responseText.trim()),t.send()}static createShader(e,i,t){const s=e.createShader(i);return e.shaderSource(s,t),e.compileShader(s),s}static loadTextureData(e,i){const t=new XMLHttpRequest;t.open("GET",e),t.responseType="arraybuffer",t.onload=s=>{const o=new DataView(t.response),n=new Float32Array(o.byteLength/Float32Array.BYTES_PER_ELEMENT);for(var h=0;h<n.length;++h)n[h]=o.getFloat32(h*Float32Array.BYTES_PER_ELEMENT,!0);i(n)},t.send()}static createTexture(e,i,t){const s=e.createTexture();return e.activeTexture(i),e.bindTexture(t,s),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(t,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(t,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),s}}new S(document.body);
